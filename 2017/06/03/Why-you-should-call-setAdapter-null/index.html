<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>(Deprecated) Why you should call setAdapter(null) · eneim's log</title><meta name="description" content="(Deprecated) Why you should call setAdapter(null) - Nam Nguyen"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="theme-color" content="#FB4D42"><meta name="google-site-verification" content="Df1Qt2ADt1yncYOOFgSQqKm6MBiEXc2W7D7hr26ErEU"><link rel="short icon" href="/img/eneim.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="/css/zoom.css"><meta property="og:title" content="(Deprecated) Why you should call setAdapter(null)"><meta property="og:image"><meta property="og:description" content=""></head><body><div class="wrap"><div class="header"><a href="/" class="logo-link"><img src="/img/avatar.jpg"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" rel="noreferrer" class="nav-list-link">HOME</a></li><li class="nav-list-item"><a href="/archives/" target="_self" rel="noreferrer" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/eneim" target="_blank" rel="noreferrer" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" rel="noreferrer" class="nav-list-link">RSS</a></li></ul></div></div><section class="container"><div class="post"><article class="post-block"><div class="wrap"><h1 class="post-title">(Deprecated) Why you should call setAdapter(null)</h1><h2 class="post-subtitle"></h2><header class="post-info">Jun 3, 2017<div class="fb-ir-time"><time datetime="2017-06-03T06:44:04.000Z" class="op-modified"></time><time datetime="2017-06-03T06:44:04.000Z" class="op-published"></time></div><div class="tags"><a href="/tags/Android" class="tag-link">#Android</a><a href="/tags/RecyclerView" class="tag-link">#RecyclerView</a><a href="/tags/EN" class="tag-link">#EN</a><a href="/tags/Dev" class="tag-link">#Dev</a><a href="/tags/Adapter" class="tag-link">#Adapter</a><a href="/tags/Beginner" class="tag-link">#Beginner</a></div></header></div><div class="wrap"><div class="post-content"><h2 id="Notice-If-you’ve-come-here-by-chance-I-want-to-say-thanks-for-the-interest"><a href="#Notice-If-you’ve-come-here-by-chance-I-want-to-say-thanks-for-the-interest" class="headerlink" title="Notice: If you’ve come here by chance, I want to say thanks for the interest."></a>Notice: If you’ve come here by chance, I want to say thanks for the interest.</h2><h2 id="And-also-want-to-have-notice-This-post-is-wrongly-representing-my-message-It-I-actually-also-uses-a-bad-example-to-raise-the-Problem-which-cause-a-misleading-discussion"><a href="#And-also-want-to-have-notice-This-post-is-wrongly-representing-my-message-It-I-actually-also-uses-a-bad-example-to-raise-the-Problem-which-cause-a-misleading-discussion" class="headerlink" title="And also want to have notice: This post is wrongly representing my message. It (I actually) also uses a bad example to raise the Problem, which cause a misleading discussion."></a>And also want to have notice: This post is wrongly representing my message. It (I actually) also uses a bad example to raise the Problem, which cause a misleading discussion.</h2><h2 id="At-the-moment-I’m-revising-my-message-as-well-as-updating-this-post-By-the-meantime-this-post-is-no-longer-a-good-place-for-reference-this-is-my-apologize"><a href="#At-the-moment-I’m-revising-my-message-as-well-as-updating-this-post-By-the-meantime-this-post-is-no-longer-a-good-place-for-reference-this-is-my-apologize" class="headerlink" title="At the moment, I’m revising my message as well as updating this post. By the meantime, this post is no longer a good place for reference, this is my apologize."></a>At the moment, I’m revising my message as well as updating this post. By the meantime, this post is no longer a good place for reference, this is my apologize.</h2><p><del><strong>TL;DR</strong>: Always call <code>RecyclerView#setAdapter(null)</code> before your <code>RecyclerView</code> is going away (in <code>onDestroy/onDestroyView/...</code>).</del></p><h1 id="1-Problem"><a href="#1-Problem" class="headerlink" title="1. Problem"></a>1. Problem</h1><p>In common tutorials about RecyclerView out there, you may see this quite frequently, inside an <code>Activity</code>‘s <code>onCreate</code> or a <code>Fragment</code>‘s <code>onCreateView</code>.</p><figure class="highlight java"><div style="overflow:auto"><table><tr><td class="code"><pre><span class="line">mAdapter = <span class="keyword">new</span> MyCoolAdapter(); <span class="comment">// here mAdapter is a member of enclosing class.</span></span><br><span class="line">recyclerView.setAdapter(adapter);</span><br></pre></td></tr></table></div></figure><p>It is pretty common step when one initialize his/her screen’s <code>RecyclerView</code>. But I rarely see people telling those “learners” what should them do on the “terminal” point. I mean, does anyone care about tearing down the RecyclerView after all?</p><p>One may ask: what’s wrong with that? Is <code>Activity</code> destroying everything after it is destroyed?</p><p>Well, for your curiosity: <strong>Will it be destroyed</strong>?</p><p>Let’s take a quick look at this question on StackOverflow: <a href="https://stackoverflow.com/questions/30132643/recyclerview-doesnt-unregister-itself-from-the-adapter-on-orientation-change" target="_blank" rel="noopener"><code>RecyclerView</code> doesn’t unregister itself from the adapter on orientation change</a>. I bet everyone can easily find the problem as well as the answer for it. But let me talk a bit more.</p><p><strong>Check points to ‘The Problem’</strong>:</p><ul><li><p>If you have used RecyclerView quite a while, you may know there are couples of useful callback for Adapter: <code>Adapter#onAttachedToRecyclerView(RecyclerView), Adapter#onDetachedFromRecyclerView(RecyclerView), Adapter#onViewAttachedToWindow(ViewHolder), Adapter#onViewDetachedFromWindow(ViewHolder)</code>.</p></li><li><p>Have you ever debuged to see when they are called? Let me sort them out for you:</p><ul><li><code>onAttachedToRecyclerView</code> is called when the Adapter is set to RecyclerView, after a call to <code>RecyclerView#setAdapter(Adapter)</code> or <code>RecyclerView#swapAdapter(Adapter, boolean)</code>. This is quite obvious.</li><li><code>onDetachedFromRecyclerView</code>, on the other hand, is called when current Adapter if going to be replaced by <strong><em>another Adapter</em></strong> (this another ‘Adapter’ can be Null). What is the point here: <strong>if you don’t replace the Adapter, this method will never be called.</strong> And what happens if an Adapter is never be “detached” from a RecyclerView? Let’s see after I explain about the other couples.</li><li><code>onViewAttachedToWindow</code> is called once RecyclerView or its LayoutManager add a View into RecyclerView (hint: go to <code>RecyclerView</code> source code and search for the following keywords: <a href="https://android.googlesource.com/platform/frameworks/support/+/refs/heads/master/v7/recyclerview/src/android/support/v7/widget/RecyclerView.java#6831" target="_blank" rel="noopener">dispatchChildAttached</a>).</li><li><code>onViewDetachedFromWindow</code>, on opposite, is called when RecyclerView or its LayoutManager detach a View from current Window.</li></ul></li><li><p>What happens when an <code>Adapter</code> is not <em>detached</em> from a <code>RecyclerView</code>? The couple of attach/detach call to an Adapter is tight to another “couple method” of Adapter: <code>registerAdapterDataObserver/unregisterAdapterDataObserver</code>. In fact, <code>registerAdapterDataObserver</code> is always called with (right before) <code>onAttachedToRecyclerView</code> and <code>unregisterAdapterDataObserver</code> is always called with (right before) <code>onDetachedFromRecyclerView</code>. In depth, <code>Adapter#registerAdapterDataObserver(AdapterDataObserver)</code> will add an instance of <code>AdapterDataObserver</code> to its observer system, to broadcast the changes to <code>RecycleView</code>‘s ecosystem. And <code>unregisterAdapterDataObserver</code> will clean it up. <code>RecyclerView</code> holds an instance of <code>RecyclerViewDataObserver</code> which is a <strong>non-static inner class</strong> that extends AdapterDataObserver (hint: go searching for <code>mObserver</code> in <code>RecyclerView</code> source code). So here you see the problem?</p></li></ul><blockquote><p>→ If <code>onDetachedFromRecyclerView</code> is not called, which is equivalent to the fact that <code>unregisterAdapterDataObserver</code> will not be called, an instance of <code>RecyclerViewDataObserver</code> will stay alive inside your <code>Adapter</code> as long as that <code>Adapter</code> is alive. <code>RecyclerViewDataObserver</code>, in turn, holds a reference to its enclosing <code>RecyclerView</code>, which in turn holds a reference to its enclosing <code>Context</code>. In this case, it is your <code>Activity</code> or <code>Fragment</code>‘s host <code>Context</code> (which is 99% an <code>Activity</code>). So your <code>Activity</code> will be held there for quite a long time, longer than you may expect.</p></blockquote><h1 id="2-The-Solution"><a href="#2-The-Solution" class="headerlink" title="2. The Solution"></a>2. The Solution</h1><p>As we have discussed quite long about the Problem, let’s see how we can solve it. Since the solution is quite obvious, I would like you to not leave here right now and maybe continue reading to the next paragraph: more motivations for you to always use this solution.</p><p>So the solution is:</p><ul><li><p>In short: remove your Adapter from the RecyclerView as soon as your RecyclerView is going to leave. Which is equivalent to calling: <code>recyclerView.setAdapter(null)</code>.</p></li><li><p>Why this solve the problem? - by calling <code>setAdapter</code> with whatever value the Adapter is (as long as it is different to current Adapter), your RecyclerView will always detach current Adapter, which means that <code>Adapter#onDetachedFromRecyclerView</code> and <code>Adapter#unregisterAdapterDataObserver</code> will properly be called. Using a null Adapter will stop the works there. That is!</p></li></ul><h1 id="3-One-more-thing"><a href="#3-One-more-thing" class="headerlink" title="3. One more thing."></a>3. One more thing.</h1><p>You may say <strong><em>well, it is not bad, but I’m not convinced yet…</em></strong>, let’s keep going a bit further.<br>There is another couple I have discussed above: <code>Adapter#onViewAttachedToWindow</code> and <code>Adapter#onViewDetachedFromWindow</code>. Let see 2 (plus 1) screenshots below to see what is the difference between calling <code>setAdapter</code> to null and not calling it.</p><p>Note: my experiment is to setup an Activity with a RecyclerView, and by pressing “Current App Stack” button I can easily make the Activity destroy/recreated. I debug on <code>RecyclerView#onChildAttachedToWindow</code> and <code>RecyclerView#onChildDetachedFromWindow</code> which is called along with those 2 methods above, respectively.</p><ul><li>Screenshot 0: after clicking to “App Stack” button, your Activity is destroyed, and by clicking to its “Snapshot” in the stack, you bring it back to life with a “recreation” (savedInstanceState is not null).</li></ul><img src="/2017/06/03/Why-you-should-call-setAdapter-null/activity-recreated.png" title="Screenshot 0: Activity is re-created"><ul><li>Screenshot 1: not calling setAdapter to null in onDestroy</li></ul><img src="/2017/06/03/Why-you-should-call-setAdapter-null/destroy-do-nothing.png" title="Screenshot 1: not calling setAdapter to null in onDestroy"><ul><li>Screenshot 2: calling setAdapter to null in onDestroy</li></ul><img src="/2017/06/03/Why-you-should-call-setAdapter-null/destroy-remove-adapter.png" title="Screenshot 2: calling setAdapter to null in onDestroy"><p>You see the difference?</p><ol><li><p>With proper call to remove the Adapter, current Views on RecyclerView are also properly detached from Window. Otherwise, your Views will not be detached, and I cannot tell where they will be after your Activity is destroyed (or maybe it will not…).</p></li><li><p>If you ignore the fact, let see further: the attached Views after your Activity is recreated are all different (see their hashCode in my Screenshot), which means that those older Views is going somewhere else, without a proper “detaching” from the old Window. Where are they? I have no idea.</p></li><li><p>Well, I maybe a bit OCD, but not seeing any “onChildDetachedFromWindow” while there is a whole bunch of “onChildAttachedToWindow” make me feel bad. Hope it is not only me out there.</p></li></ol><p>That’s all. Happy Coding!</p></div></div></article></div><div class="qrcode"><canvas id="share-qrcode"></canvas><p class="notice">Scan the QR code to share this article</p><script src="/js/qrious.js"></script><script async defer type="text/javascript">new QRious({element:document.getElementById("share-qrcode"),value:document.location.href})</script></div><div class="money-like"><script type="text/javascript" src="https://ko-fi.com/widgets/widget_2.js"></script><script type="text/javascript">kofiwidget2.init("Give the creator a Koffee? ^^!","#6e61ab","A342OWW"),kofiwidget2.draw()</script></div></section><div class="wrap"><footer><div class="paginator"><a href="/2017/06/25/toro-3-0-alpha-1-was-born-from-scratch-with-love/" class="prev">NEWER</a><a href="/2017/04/27/The-future-of-Toro-in-relationship-with-ExoPlayer/" class="next">OLDER</a></div><div id="disqus_thread"></div><script>var disqus_shortname="eneim",disqus_identifier="2017/06/03/Why-you-should-call-setAdapter-null/",disqus_title="(Deprecated) Why you should call setAdapter(null)",disqus_url="https://ene.im/2017/06/03/Why-you-should-call-setAdapter-null/",disqus_config=function(){this.page.url=disqus_url,this.page.identifier=disqus_identifier};!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><script id="dsq-count-scr" src="//undefined.disqus.com/count.js" async></script><div class="copyright"><p>© 2016 - 2019 <a href="https://ene.im">Nam Nguyen</a>, unless otherwise noted.</p></div></footer></div><script>!function(e,a,t,n,g,c){e.GoogleAnalyticsObject=n,e.ga||(e.ga=function(){(e.ga.q=e.ga.q||[]).push(arguments)}),e.ga.l=+new Date,g=a.createElement(t),c=a.getElementsByTagName(t)[0],g.src="//www.google-analytics.com/analytics.js",c.parentNode.insertBefore(g,c)}(window,document,"script","ga"),ga("create","UA-72567780-7","auto"),ga("send","pageview")</script><script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script><script src="/js/zoom.js"></script></body></html>