<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="description" content="eneim | the simple, the best"><meta name="keyword" content="eneim"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="google-site-verification" content="Df1Qt2ADt1yncYOOFgSQqKm6MBiEXc2W7D7hr26ErEU"><meta name="description" content="TL,DR: Just in case you are interested in Video playback, especially in RecyclerView, there is something new for you: https://github.com/eneim/toro/releases/tag/3.0.0-alpha1">
<meta name="keywords" content="Android,RecyclerView,MediaPlayer,ExoPlayer,Toro,EN,Dev">
<meta property="og:type" content="article">
<meta property="og:title" content="Toro 3.0 alpha 1 was born, from scratch with love">
<meta property="og:url" content="https://ene.im/2017/06/25/toro-3-0-alpha-1-was-born-from-scratch-with-love/index.html">
<meta property="og:site_name" content="eneim's log">
<meta property="og:description" content="TL,DR: Just in case you are interested in Video playback, especially in RecyclerView, there is something new for you: https://github.com/eneim/toro/releases/tag/3.0.0-alpha1">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://ene.im/js/lazyload-plugin/loading.svg">
<meta property="og:updated_time" content="2019-02-28T11:48:15.376Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Toro 3.0 alpha 1 was born, from scratch with love">
<meta name="twitter:description" content="TL,DR: Just in case you are interested in Video playback, especially in RecyclerView, there is something new for you: https://github.com/eneim/toro/releases/tag/3.0.0-alpha1">
<meta name="twitter:image" content="https://ene.im/js/lazyload-plugin/loading.svg">
<meta name="twitter:creator" content="@ene__im"><title>Toro 3.0 alpha 1 was born, from scratch with love</title><link rel="shortcut icon" href="/img/eneim.ico" type="image/x-icon"><link href="/styles/site.css" rel="stylesheet"><link href="/styles/zoom.css" rel="stylesheet"><link href="/styles/youtube.css" rel="stylesheet"></head><body><header class="container" id="header"><div class="header"><div class="header-left"><div class="avatar"><img src="/images/avatar.jpg"></div><div class="author"><div class="author-name"><a href="/">eneim</a></div><div class="about-me">the simple, the best</div></div></div><div class="header-right"><ul class="navigation"><li><a href="/archives">archives</a></li><li><a href="/atom.xml">rss</a></li></ul></div><div class="about-me-mask"><div class="about-me-wrap"><div class="about-me__header"><div class="avatar"><img src="/images/avatar.jpg"></div></div><ul class="socials"><li class="social-item"><span class="label"><img src="/images/socials/github.svg" alt="https://github.com/eneim"></span><a href="https://github.com/eneim" target="_blank" rel="noreferrer" title="https://github.com/eneim">https://github.com/eneim</a></li><li class="social-item"><span class="label"><img src="/images/socials/email.svg" alt="nam@ene.im"></span><span>nam@ene.im</span></li></ul></div></div></div></header><div class="container post"><section class="article"><div class="title">Toro 3.0 alpha 1 was born, from scratch with love</div><div class="date"># 2017/06/25</div><div class="content"><meta name="generator" content="Hexo 3.8.0"><h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL,DR:"></a>TL,DR:</h2><blockquote>
<p>Just in case you are interested in Video playback, especially in RecyclerView, there is something new for you: <a href="https://github.com/eneim/toro/releases/tag/3.0.0-alpha1" target="_blank" rel="noopener">https://github.com/eneim/toro/releases/tag/3.0.0-alpha1</a></p>
</blockquote>
<div style="text-align:center">
  <div class="github-card" data-user="eneim" data-repo="toro" data-width="400" data-theme="default" data-target data-client-id data-client-secret></div>
</div>
<script src="/github-card-lib/githubcard.js"></script>

<a id="more"></a>
<h4 id="A-demonstration-mimic-Facebook-timeline-and-more"><a href="#A-demonstration-mimic-Facebook-timeline-and-more" class="headerlink" title="A demonstration (mimic Facebook timeline and more)"></a>A demonstration (mimic Facebook timeline and more)</h4><div class="ytx-container"><br>  <div class="ytx-square"><br>    <object class="ytx-square-child" style="width: 100%; height: 100%; float: none; clear: both; margin: 2px auto;" data="https://www.youtube.com/embed/rSAGaNM2_t8"></object><br>  </div><br></div>

<hr>
<h2 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h2><p>After nearly a month of active development, I would like to announce that Toro has a new major update: Toro 3.0 (alpha 1). Toro 3.0 is a complete rewritten version of Toro.</p>
<h2 id="Update-summary"><a href="#Update-summary" class="headerlink" title="Update summary"></a>Update summary</h2><p>Toro 3.0 removes the use of static setup in Toro 2 (<code>Toro.attach/detach/init/register/unregister</code> …), which was a burden for both maintainer and users. </p>
<p>Instead, all the necessary logic is put into Container - an empowered RecyclerView. In fact, in the RecyclerView eco-system (RecyclerView, Adapter, LayoutManager, ViewHolder, …), RecyclerView is the least likely to be customised (comparing to Adapter and LayoutManager). With that, I put my effort to integrate the beauty of Toro 2.x into a single RecyclerView. As a result, user just need to replace their RecyclerView with Container view to have the support from Toro.</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"><!-- just this and you have all the support from Toro 3.0 --></span></span><br><span class="line"><span class="tag"><<span class="name">im.ene.toro.widget.Container</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/recycler_view"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">/></span></span><br></pre></td></tr></tbody></table></figure>
<p>Also, there is no need to implement the MediaPlayerManager which is tight to Adapter in Toro 2. I was struggling with this constraint for a long time after the release, and finally I know it must be removed. In Toro 3, there is no customisable MediaPlayerManager, its logic is instead integrated inside Container.</p>
<p>What user still need to do, is to implement the Player interface into the ViewHolder. This is a must, since there is no other way the Container could know if it is talking to a Player or not. But instead of dozens of methods in Toro 2.x, the ToroPlayer interface now contains only a few methods which are enough to control the<br>playback, and few more for the callback from the playback update. A simple ViewHolder implementation looks like below</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimelineVideoViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> <span class="keyword">implements</span> <span class="title">ToroPlayer</span> </span>{</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Nullable</span> SimpleExoPlayerViewHelper helper;</span><br><span class="line">  <span class="meta">@Nullable</span> <span class="keyword">private</span> Uri mediaUri;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@BindView</span>(R.id.fb_video_player) SimpleExoPlayerView playerView;</span><br><span class="line">  </span><br><span class="line">  TimelineVideoViewHolder(View itemView) {</span><br><span class="line">    <span class="keyword">super</span>(itemView);</span><br><span class="line">    ButterKnife.bind(<span class="keyword">this</span>, itemView);</span><br><span class="line">    playerView.setVisibility(View.VISIBLE);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">void</span> <span class="title">bind</span><span class="params">(TimelineAdapter adapter, FbItem item, List<object> payloads)</object></span> </span>{</span><br><span class="line">    <span class="keyword">super</span>.bind(adapter, item, payloads);</span><br><span class="line">    <span class="keyword">if</span> (item != <span class="keyword">null</span> && item <span class="keyword">instanceof</span> MediaEntity) {</span><br><span class="line">      MediaUrl url = ((MediaEntity) item).getMediaUrl();</span><br><span class="line">      mediaUri = url.getUri();</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="meta">@NonNull</span> <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> View <span class="title">getPlayerView</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.playerView;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="meta">@NonNull</span> <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> PlaybackInfo <span class="title">getCurrentPlaybackInfo</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> helper != <span class="keyword">null</span> ? helper.updatePlaybackInfo() : <span class="keyword">new</span> PlaybackInfo();</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(@NonNull Container container, @NonNull PlaybackInfo playbackInfo)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (helper == <span class="keyword">null</span>) {</span><br><span class="line">      helper = <span class="keyword">new</span> SimpleExoPlayerViewHelper(container, <span class="keyword">this</span>, mediaUri);</span><br><span class="line">    }</span><br><span class="line">    helper.initialize(playbackInfo);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (helper != <span class="keyword">null</span>) helper.play();</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pause</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (helper != <span class="keyword">null</span>) helper.pause();</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPlaying</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> helper != <span class="keyword">null</span> && helper.isPlaying();</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (helper != <span class="keyword">null</span>) {</span><br><span class="line">      <span class="keyword">try</span> {</span><br><span class="line">        helper.cancel();</span><br><span class="line">      } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">      }</span><br><span class="line">      helper = <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">wantsToPlay</span><span class="params">()</span> </span>{</span><br><span class="line">    ViewParent parent = itemView.getParent();</span><br><span class="line">    <span class="keyword">float</span> offset = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (parent != <span class="keyword">null</span> && parent <span class="keyword">instanceof</span> View) {</span><br><span class="line">      offset = ToroUtil.visibleAreaOffset(playerView, (View) parent);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> offset >= <span class="number">0.85</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPlayerOrder</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> getAdapterPosition();</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>This release also open a way for multiple simultaneous playbacks, even though I would not recommend it. Now with a custom <code>PlayerSelector</code>, you can have the behavior like below: different number of Video playback for each row.</p>
<div class="progress-images" style="width:288px"><div class="progress-images--placeholder" style="padding-bottom: 177.77777777777777%;"></div><img src="/js/lazyload-plugin/loading.svg" class="progress-images--original" data-original="/2017/06/25/toro-3-0-alpha-1-was-born-from-scratch-with-love/demo-player-selector.gif" data-thumb="/images/thumb/4298d9b28b9a2df8898a1c4b69e436dd.gif"></div>
<p>Deep down to the implementation, Toro 3.0 is no longer listen to Playback state. In fact, it was a pain in my ass when I try to follow the state machine of 3 Media player APIs (MediaPlayer, ExoPlayer 1, ExoPlayer 2) to tell Toro instance to deal with a Player when it is ready to play or when it completes the playback. In Toro 3.0, it is now just asking the Player to initialize the resource for playback, and then start it, or pause it, on demand. All the playback state update is ignore by Toro, and users will have the freedom to integrate their own callback logic.</p>
<p>This change will asks the users more to handle the callback by themselves, which can be hard at first. So I put 2 helpers classes to help them getting start with Toro 3.0 easier. Right now only ExoPlayer 2.+ and Android MediaPlayer are supported. And there will be no plan to support more playback SDKs. But as users will need to implement 3rd party SDK such as Youtube, Vimeo, etc, I’m always try to help as much as possible.</p>
<p>More detail about how to use Toro 3.0 alpha 1 can be found in README as well as the sample app. So it is highly recommended to go though the README as well as app module before asking for any implementation details.</p>
<p><strong>What happens with Toro 2.x</strong>: I will try to answer as much as possible, and fix fatal issues only. All up coming development will go to 3.+ and so on.</p>
<h2 id="Final-words"><a href="#Final-words" class="headerlink" title="Final words"></a>Final words</h2><p>I would like to write more about this release, as well as what I have learnt about <code>RecyclerView</code> while creating this and more. But for now, I will take a rest and wait for issue report.</p>
<h2 id="Happy-scrolling"><a href="#Happy-scrolling" class="headerlink" title="Happy scrolling!"></a>Happy scrolling!</h2></div><div class="tags"><a class="tag-link" href="/tags/android/">Android</a><a class="tag-link" href="/tags/dev/">Dev</a><a class="tag-link" href="/tags/en/">EN</a><a class="tag-link" href="/tags/exoplayer/">ExoPlayer</a><a class="tag-link" href="/tags/mediaplayer/">MediaPlayer</a><a class="tag-link" href="/tags/recyclerview/">RecyclerView</a><a class="tag-link" href="/tags/toro/">Toro</a></div></section></div><div class="container"><ul class="nav"><li>previous: <a href="/2017/07/09/toro-101-how-to-1/">Toro 101 - Videos on RecyclerView, starts/pauses automatically when scroll</a></li><li>next: <a href="/2017/06/03/Why-you-should-call-setAdapter-null/">(Deprecated) Why you should call setAdapter(null)</a></li></ul></div><div id="backToTop"><div class="back-arrow back-arrow-left"></div><div class="back-arrow back-arrow-right"></div></div><footer class="container"><div class="rights"><span>Powered by </span><a href="http://hexo.io" target="_blank" rel="noreferrer">Hexo</a><span>, Theme </span><a href="https://github.com/gary-Shen/hexo-theme-curry" target="_blank" rel="noreferrer">Curry</a><span>.</span></div></footer><script src="/script/jquery.min.js"></script><script src="/script/transition.js"></script><script src="/script/zoom.js"></script><script src="/script/index.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-72567780-7', 'auto');
ga('send', 'pageview');</script><script src="/script/post.js"></script><script>var disqus_shortname = 'eneim';var disqus_url = 'https://ene.im/2017/06/25/toro-3-0-alpha-1-was-born-from-scratch-with-love/';
(function(){
 var dsq = document.createElement('script');
 dsq.type = 'text/javascript';
 dsq.async = true;
 dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
 (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script type="text/javascript" charset="utf-8" src="/js/lazyload-plugin/lazyload.intersectionObserver.min.js"></script></body></html>