<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Toro 3.0 alpha 1 was born, from scratch with love · eneim's log</title><meta name="description" content="Toro 3.0 alpha 1 was born, from scratch with love - Nam Nguyen"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="theme-color" content="#FB4D42"><meta name="google-site-verification" content="xsBM7pl1-5NgKqJ1CzbmPWtcSKAKY7TlEeIPp_GdWBU"><link rel="short icon" href="/img/eneim.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="/css/zoom.css"><meta property="og:title" content="Toro 3.0 alpha 1 was born, from scratch with love"><meta property="og:image"><meta property="og:description" content=""><link rel="stylesheet" href="/css/youtube.css"><script async defer src="/js/youtube.js"></script></head><body><div class="wrap"><div class="header"><a href="/" class="logo-link"><img src="/img/avatar.jpg"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" rel="noreferrer" class="nav-list-link">HOME</a></li><li class="nav-list-item"><a href="/archives/" target="_self" rel="noreferrer" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/eneim" target="_blank" rel="noreferrer" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" rel="noreferrer" class="nav-list-link">RSS</a></li></ul></div></div><section class="container"><div class="post"><article class="post-block"><div class="wrap"><h1 class="post-title">Toro 3.0 alpha 1 was born, from scratch with love</h1><h2 class="post-subtitle"></h2><header class="post-info">Jun 25, 2017<div class="fb-ir-time"><time datetime="2017-06-25T05:45:31.000Z" class="op-modified"></time><time datetime="2017-06-25T05:45:31.000Z" class="op-published"></time></div><div class="tags"><a href="/tags/Android" class="tag-link">#Android</a><a href="/tags/RecyclerView" class="tag-link">#RecyclerView</a><a href="/tags/MediaPlayer" class="tag-link">#MediaPlayer</a><a href="/tags/ExoPlayer" class="tag-link">#ExoPlayer</a><a href="/tags/Toro" class="tag-link">#Toro</a><a href="/tags/EN" class="tag-link">#EN</a><a href="/tags/Dev" class="tag-link">#Dev</a></div></header></div><div class="wrap"><div class="post-content"><h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL,DR:"></a>TL,DR:</h2><blockquote><p>Just in case you are interested in Video playback, especially in RecyclerView, there is something new for you: <a href="https://github.com/eneim/toro/releases/tag/3.0.0-alpha1" target="_blank" rel="noopener">https://github.com/eneim/toro/releases/tag/3.0.0-alpha1</a></p></blockquote><div style="text-align:center"><div class="github-card" data-user="eneim" data-repo="toro" data-width="400" data-theme="default" data-target="" data-client-id="" data-client-secret=""></div></div><script src="/github-card-lib/githubcard.js"></script><h4 id="A-demonstration-mimic-Facebook-timeline-and-more"><a href="#A-demonstration-mimic-Facebook-timeline-and-more" class="headerlink" title="A demonstration (mimic Facebook timeline and more)"></a>A demonstration (mimic Facebook timeline and more)</h4><div class="ytx-container"><br><div class="ytx-square"><br><object class="ytx-square-child" style="width:100%;height:100%;float:none;clear:both;margin:2px auto" data="https://www.youtube.com/embed/rSAGaNM2_t8"></object><br></div><br></div><hr><h2 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h2><p>After nearly a month of active development, I would like to announce that Toro has a new major update: Toro 3.0 (alpha 1). Toro 3.0 is a complete rewritten version of Toro.</p><h2 id="Update-summary"><a href="#Update-summary" class="headerlink" title="Update summary"></a>Update summary</h2><p>Toro 3.0 removes the use of static setup in Toro 2 (<code>Toro.attach/detach/init/register/unregister</code> …), which was a burden for both maintainer and users.</p><p>Instead, all the necessary logic is put into Container - an empowered RecyclerView. In fact, in the RecyclerView eco-system (RecyclerView, Adapter, LayoutManager, ViewHolder, …), RecyclerView is the least likely to be customised (comparing to Adapter and LayoutManager). With that, I put my effort to integrate the beauty of Toro 2.x into a single RecyclerView. As a result, user just need to replace their RecyclerView with Container view to have the support from Toro.</p><figure class="highlight xml"><div style="overflow:auto"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- just this and you have all the support from Toro 3.0 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">im.ene.toro.widget.Container</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/recycler_view"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></div></figure><p>Also, there is no need to implement the MediaPlayerManager which is tight to Adapter in Toro 2. I was struggling with this constraint for a long time after the release, and finally I know it must be removed. In Toro 3, there is no customisable MediaPlayerManager, its logic is instead integrated inside Container.</p><p>What user still need to do, is to implement the Player interface into the ViewHolder. This is a must, since there is no other way the Container could know if it is talking to a Player or not. But instead of dozens of methods in Toro 2.x, the ToroPlayer interface now contains only a few methods which are enough to control the<br>playback, and few more for the callback from the playback update. A simple ViewHolder implementation looks like below</p><figure class="highlight java"><div style="overflow:auto"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimelineVideoViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> <span class="keyword">implements</span> <span class="title">ToroPlayer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Nullable</span> SimpleExoPlayerViewHelper helper;</span><br><span class="line">  <span class="meta">@Nullable</span> <span class="keyword">private</span> Uri mediaUri;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@BindView</span>(R.id.fb_video_player) SimpleExoPlayerView playerView;</span><br><span class="line">  </span><br><span class="line">  TimelineVideoViewHolder(View itemView) &#123;</span><br><span class="line">    <span class="keyword">super</span>(itemView);</span><br><span class="line">    ButterKnife.bind(<span class="keyword">this</span>, itemView);</span><br><span class="line">    playerView.setVisibility(View.VISIBLE);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">void</span> <span class="title">bind</span><span class="params">(TimelineAdapter adapter, FbItem item, List&lt;Object&gt; payloads)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.bind(adapter, item, payloads);</span><br><span class="line">    <span class="keyword">if</span> (item != <span class="keyword">null</span> &amp;&amp; item <span class="keyword">instanceof</span> MediaEntity) &#123;</span><br><span class="line">      MediaUrl url = ((MediaEntity) item).getMediaUrl();</span><br><span class="line">      mediaUri = url.getUri();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@NonNull</span> <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> View <span class="title">getPlayerView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.playerView;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@NonNull</span> <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> PlaybackInfo <span class="title">getCurrentPlaybackInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> helper != <span class="keyword">null</span> ? helper.updatePlaybackInfo() : <span class="keyword">new</span> PlaybackInfo();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(@NonNull Container container, @NonNull PlaybackInfo playbackInfo)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (helper == <span class="keyword">null</span>) &#123;</span><br><span class="line">      helper = <span class="keyword">new</span> SimpleExoPlayerViewHelper(container, <span class="keyword">this</span>, mediaUri);</span><br><span class="line">    &#125;</span><br><span class="line">    helper.initialize(playbackInfo);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (helper != <span class="keyword">null</span>) helper.play();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pause</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (helper != <span class="keyword">null</span>) helper.pause();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPlaying</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> helper != <span class="keyword">null</span> &amp;&amp; helper.isPlaying();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (helper != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        helper.cancel();</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">      helper = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">wantsToPlay</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ViewParent parent = itemView.getParent();</span><br><span class="line">    <span class="keyword">float</span> offset = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (parent != <span class="keyword">null</span> &amp;&amp; parent <span class="keyword">instanceof</span> View) &#123;</span><br><span class="line">      offset = ToroUtil.visibleAreaOffset(playerView, (View) parent);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> offset &gt;= <span class="number">0.85</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPlayerOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> getAdapterPosition();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>This release also open a way for multiple simultaneous playbacks, even though I would not recommend it. Now with a custom <code>PlayerSelector</code>, you can have the behavior like below: different number of Video playback for each row.</p><img src="/2017/06/25/toro-3-0-alpha-1-was-born-from-scratch-with-love/demo-player-selector.gif"><p>Deep down to the implementation, Toro 3.0 is no longer listen to Playback state. In fact, it was a pain in my ass when I try to follow the state machine of 3 Media player APIs (MediaPlayer, ExoPlayer 1, ExoPlayer 2) to tell Toro instance to deal with a Player when it is ready to play or when it completes the playback. In Toro 3.0, it is now just asking the Player to initialize the resource for playback, and then start it, or pause it, on demand. All the playback state update is ignore by Toro, and users will have the freedom to integrate their own callback logic.</p><p>This change will asks the users more to handle the callback by themselves, which can be hard at first. So I put 2 helpers classes to help them getting start with Toro 3.0 easier. Right now only ExoPlayer 2.+ and Android MediaPlayer are supported. And there will be no plan to support more playback SDKs. But as users will need to implement 3rd party SDK such as Youtube, Vimeo, etc, I’m always try to help as much as possible.</p><p>More detail about how to use Toro 3.0 alpha 1 can be found in README as well as the sample app. So it is highly recommended to go though the README as well as app module before asking for any implementation details.</p><p><strong>What happens with Toro 2.x</strong>: I will try to answer as much as possible, and fix fatal issues only. All up coming development will go to 3.+ and so on.</p><h2 id="Final-words"><a href="#Final-words" class="headerlink" title="Final words"></a>Final words</h2><p>I would like to write more about this release, as well as what I have learnt about <code>RecyclerView</code> while creating this and more. But for now, I will take a rest and wait for issue report.</p><h2 id="Happy-scrolling"><a href="#Happy-scrolling" class="headerlink" title="Happy scrolling!"></a>Happy scrolling!</h2></div></div></article></div><div class="qrcode"><canvas id="share-qrcode"></canvas><p class="notice">Scan the QR code to share this article</p><script src="/js/qrious.js"></script><script async defer type="text/javascript">new QRious({element:document.getElementById("share-qrcode"),value:document.location.href})</script></div><div class="money-like"><script type="text/javascript" src="https://ko-fi.com/widgets/widget_2.js"></script><script type="text/javascript">kofiwidget2.init("Feel good for a Koffee? ^^!","#6e61ab","A342OWW"),kofiwidget2.draw()</script></div></section><div class="wrap"><footer><div class="paginator"><a href="/2017/07/09/toro-101-how-to-1/" class="prev">NEWER</a><a href="/2017/06/03/Why-you-should-call-setAdapter-null/" class="next">OLDER</a></div><div id="disqus_thread"></div><script>var disqus_shortname="eneim",disqus_identifier="2017/06/25/toro-3-0-alpha-1-was-born-from-scratch-with-love/",disqus_title="Toro 3.0 alpha 1 was born, from scratch with love",disqus_url="https://eneim.github.io/2017/06/25/toro-3-0-alpha-1-was-born-from-scratch-with-love/";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><script id="dsq-count-scr" src="//eneim.disqus.com/count.js" async></script><div class="copyright"><p>© 2016 - 2019 <a href="https://eneim.github.io">Nam Nguyen</a>, unless otherwise noted.</p></div></footer></div><script>!function(e,a,t,n,g,c){e.GoogleAnalyticsObject=n,e.ga||(e.ga=function(){(e.ga.q=e.ga.q||[]).push(arguments)}),e.ga.l=+new Date,g=a.createElement(t),c=a.getElementsByTagName(t)[0],g.src="//www.google-analytics.com/analytics.js",c.parentNode.insertBefore(g,c)}(window,document,"script","ga"),ga("create","UA-72567780-7","auto"),ga("send","pageview")</script><script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script><script src="/js/zoom.js"></script></body></html>